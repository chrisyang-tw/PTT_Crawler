# 利用 Python + Selenium 製作批踢踢爬文程式

## 1. 前言

歡迎使用 PTT 爬文程式，本程式能擷取 PTT 各大看板上的文章，統計各篇文章推噓文數，並匯出成 Excel 檔中。若您擷取的是行動通訊板，本程式還能判斷各篇文章屬於何種廠牌。若您時常需要監測競品與我公司的網路聲量，本程式將會是您進行資料蒐集的一大利器！

**本程式的最大特色**

- **功能強大**：各看板皆適用，兩種爬蟲方式任君挑選，資料擷取無死角。
- **省時省力**：再也不必透過肉眼判斷廠牌名稱；推文噓文數一目了然，不必點開每篇文章。
- **便於分析**：匯出成 Excel 檔案，篩選分析超方便。

### PTT 是什麼？

PTT 是台灣最大的網路論壇，擁有超過兩萬個不同主題的看板。常見的看板包括：

- 行動通訊板([MobileComm](https://ptt.cc/bbs/MobileComm/index.html))：行動裝置相關新聞討論、手機疑難雜症詢問、電信資費請益。
- 電腦消費板([PC_Shopping](https://www.ptt.cc/bbs/PC_Shopping/index.html))：桌上型電腦組裝討論與請益、電腦零組件情報資訊交流。
- 筆電消費板([NB-Shopping](https://www.ptt.cc/bbs/nb-shopping/index.html))：筆記型電腦買賣、討論、新聞情報交流。
- 另外還有八卦板、電影板、男女板...等等，促繁不及備載。

## 2. 快速入門

### Step 1: 下載

下載壓縮包：https://github.com/chrisyang-tw/PTT_Crawler/raw/master/PTT_Crawler_EXE.zip

### Step 2: 解壓縮

確認資料夾中 "chromedriver.exe", "keyword.csv", "ptt_crawler_1.5.exe" 三個檔案皆存在。

### Step 3: 檢查與更新 keyword 檔案

若您要爬取行動通訊板 (MobileComm) 的文章，請先檢查近期是否有新機上市、即將上市或有外流新聞。若有，請打開 "keyword.csv" 檔案，並將手機型號新增於 `B1` 至 `B10` 的儲存格中（每列代表的是一個品牌，品牌名稱列於 `A1` 至 `A10` 中），並以逗號 "," 與其他關鍵字區隔。**若您要擷取其他看板文章，請忽略此步驟。**

**注意：請不要更動到品牌名稱，也不要更動列數**

### Step 4: 打開主程式並依畫面指示操作

打開 "ptt_crawler_1.5.exe" （以下將以主程式代表此程式），並遵循畫面指示操作。

首先選擇欲爬文的看板名稱，預設的看板包含了行動通訊板、電腦消費板、筆電消費板、科技業板，若您想擷取其他看板，也可以選擇「其他」並自行輸入該看板首頁網址（例如您想擷取八卦板，請輸入：https://www.ptt.cc/bbs/Gossiping/index.html）。

接著選擇文章的取得方式。取得方式分為兩種：

- 輸入天數：您可以輸入要取得過去幾天內的文章，例如輸入 "14"，程式即會將從現在算起過去兩周的所有文章擷取下來。**由於程式的限制，此方式只適用於擷取當年度的文章，若您欲取得跨年度的文章請使用第二種方式。**

- 輸入頁數：您可以輸入程式要從哪一頁開始擷取文章。這時您需要開啟瀏覽器並觀察網址列。
以 PTT 行動通訊板為例，當您開啟網頁時，應會發現網址列最後一段會顯示 `"index.html"`，這時您可以點擊右上角的上頁按鈕 *(如圖一)*，您便會發現網址列的最後一段會變更為 `"indexXXXX.html"`，而您看到的 `XXXX` 四位數字便是該頁的頁數 *(如圖二)*。此時您便能透過手動修改頁數，觀察該頁的發文日期，來選擇您要從哪一頁開始擷取。舉例來說，我想擷取從 2018 年 1 月開始的文章，當現在所在的頁數是第 6500 頁時，我會將網址列 `"index6500.html"` 的 `6500` 更改為 6000, 5500, ...慢慢往前尋找哪一頁的時間點才是 2018 年 1 月的文章，最後找到是第 5038 頁，即可返回程式並輸入 5038，程式就能從此頁開始擷取文章。

    圖一：PTT MobileComm 首頁。
![ptt_index](/md_img/ptt_index.jpg)

    圖二：點擊上頁後，發現網址列有所改變。
![ptt_index](/md_img/ptt_index_02.jpg)

### Step 5: 開始爬蟲

在以上步驟接設定完成後將會開始執行爬蟲。此時程式會自動開啟一個 Chrome 瀏覽器視窗，請勿驚慌與關閉。若您是第一次使用，可能會跳出防火牆訊息，此為正常現象，請將其關閉或接受（拒絕亦可）。另外，主程式上將會顯示擷取的進度，若您不確定程式是否有在運作，可以前往主程式上查看。

### Step 6: 執行完畢

爬蟲完畢後，瀏覽器將會關閉，而您會在主程式中看到正在寫入的訊息。寫入完成後，您將會發現與程式相同的資料夾中會出現一個 CSV 檔案，您可以使用 Excel 打開，但由於 CSV 檔案的特性，**請務必使用 Excel 另存新檔成 xlsx 檔後再開始於 Excel 上操作與分析**。

完成此步驟後，您即可開始利用 Excel 的排序與篩選功能，挑選出您想要的文章，或觀察各品牌的討論熱門程度。